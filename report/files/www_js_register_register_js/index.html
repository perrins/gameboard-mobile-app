<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - www/js/register/register.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>www/js/register/register.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">64.69</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">423</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">36.14</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">3.46</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">&#039;use strict&#039;;

angular.module(&quot;gameboard.register&quot;, [])

	.config([&quot;$stateProvider&quot;, function ($stateProvider) {

        $stateProvider.state(&quot;register&quot;, {
            url: &quot;/register&quot;,
            templateUrl: &quot;js/register/register.html&quot;,
            controller: &quot;RegisterCtrl&quot;
        })
        $stateProvider.state(&quot;account&quot;, {
                url: &quot;/account&quot;,
                templateUrl: &quot;js/register/account.html&quot;,
                controller: &quot;AccountCtrl&quot;
        });

	}])

    .factory(&#039;SocialIntegration&#039;, function ($q, $cacheFactory,$rootScope, $stateParams,$http,$cookies, ACCESS) {

        return {

            getAccessToken: function (provider) {



                debugger;

                // Create a Defered, one of the collest programming patterns going
                var defer = $q.defer();

                // Get A Code
                var calls = Q.fcall ( function () {

                    /*
                    // Request a Server Side Generated Auth Code
                    var def = $q.defer();

                    // Get handle to the CloudCode service
                    var cc = IBMCloudCode.getService();
                    var uri = new IBMUriBuilder().append(ACCESS.SOCIAL_AUTH_CODE).toString();

                    // Get the Genres
                    cc.get(uri, {
                        &quot;handleAs&quot;: &quot;json&quot;
                    }).then(function (token,options,data) {
                        debugger;
                        def.resolve(token);
                    }).catch(function (err) {
                        def.reject(err);
                    })

                    return def.promise;

                }).then( function(csrf) {
*/
                    var def = $q.defer();

                    if(!$rootScope.security_token) {
                        def.reject({error:&quot;no security token which should have been resolved at signin&quot;});
                    } else {

                        // Present Token to Popup
                        OAuth.popup(provider, {
                            cache: false,
                            state: $rootScope.security_token.token
                        }).then(function (auth) {
                            debugger;
                            def.resolve(auth);
                        }).fail(function(err){
                            def.reject(err);
                        });
                    }

                    return def.promise;

                }).then(function(auth) {

                    // Check if we need to
                    var def = $q.defer();

                    var options =  {handleAs:&quot;json&quot;};
                    if($rootScope.google &amp;&amp; $rootScope.user) {
                        options.headers = {&quot;X-GB-ACCESS-TOKEN&quot;:$rootScope.google.access_token,
                            &quot;X-GB-USER-ID&quot;:$rootScope.user.raw.id};
                    }

                    // Add in CSRF Token
                    if(_.has($rootScope.security_token,&quot;csrf&quot;)){
                        options.headers[&quot;x-csrf-token&quot;] = $rootScope.security_token.csrf;
                    }

                    // Get handle to the CloudCode service
                    var cc = IBMCloudCode.getService();
                    var uri = new IBMUriBuilder().append(ACCESS.SOCIAL_AUTH).append(provider).toString();
                    uri += &quot;?_csrf=&quot;+$rootScope.security_token;

                    console.log(&quot;CODE :&quot;+auth.code);
                    console.log(&quot;CSRF :&quot;+$rootScope.security_token.csrf);

                    // Now ask for the Access Token
                    cc.post(uri, {code:auth.code},options).then(function (data) {
                        // Lets Check if we have an object
                        if(!_.isObject(data)) {
                            def.reject(data);
                        } else {
                            // Resolve the Data
                            def.resolve({auth: auth, code: auth.code, token:data.token, user: data.user});
                        }
                    }).catch(function (err) {
                        def.reject(err);
                    });

                    return def.promise;

                }).fail(function(err) {
                    console.log(&quot;ERROR:&quot;+JSON.Stringify(err));
                    defer.reject(err);
                });

                // Return the compound promise
                defer.resolve(calls);

                return defer.promise;

            }
        }

    })

// A simple controller that shows a tapped item&quot;s data
    .controller(&quot;RegisterCtrl&quot;, function ($ionicScrollDelegate,$cookies, $rootScope, $state, $scope, MembersService,$ionicLoading, WizardHandler, $ionicPopup,SocialIntegration) {

        // Check if user is defined
        if (!$rootScope.user) {
            $state.go(&quot;signin&quot;);
        }

        // Keep a Scope copy of the wizard
        $scope.init = function init() {
            $scope.wizard = WizardHandler.wizard(&quot;registerWizard&quot;);
        }

        $scope.actionText = &quot;Next&quot;;

        // Set the Form
        $scope.setPersonalForm = function(personalForm) {
            $scope.personalForm = personalForm;
        }

        $scope.setSocialForm = function(socialForm) {
            $scope.socialForm = socialForm;
        }

        $scope.countries = [
            {id: 1, text: &#039;USA&#039;, checked: false, icon: &quot;http://www.sciencekids.co.nz/images/pictures/flags680/United_States.jpg&quot;},
            {id: 2, text: &#039;United Kingdom&#039;, checked: true, icon: &#039;http://www.sciencekids.co.nz/images/pictures/flags680/United_Kingdom.jpg&#039;},
            {id: 3, text: &#039;Japan&#039;, checked: false, icon: &quot;http://www.sciencekids.co.nz/images/pictures/flags680/Japan.jpg&quot;},
            {id: 4, text: &#039;Germany&#039;, checked: false, icon: &quot;http://www.sciencekids.co.nz/images/pictures/flags680/Germany.jpg&quot;}];

        $scope.platforms = [
            {id: 1, text: &#039;PS4&#039;, checked: false, icon: null},
            {id: 2, text: &#039;PS3&#039;, checked: false, icon: null},
            {id: 3, text: &#039;XBOX 360&#039;, checked: false, icon: null},
            {id: 4, text: &#039;XBOX One&#039;, checked: false, icon: null},
            {id: 5, text: &#039;Wii&#039;, checked: false, icon: null},
            {id: 6, text: &#039;Wii U&#039;, checked: false, icon: null},
            {id: 7, text: &#039;Apple Mac&#039;, checked: false, icon: null},
            {id: 8, text: &#039;PC&#039;, checked: false, icon: null},
            {id: 9, text: &#039;Gamers PC&#039;, checked: false, icon: null},

            {id: 10, text: &#039;XBOX One&#039;, checked: false, icon: null},
            {id: 11, text: &#039;XBOX One&#039;, checked: false, icon: null},


            {id: 12, text: &#039;Steam&#039;, checked: false, icon: null},
            {id: 13, text: &#039;iPad&#039;, checked: false, icon: null},
            {id: 14, text: &#039;Android Tablet&#039;, checked: false, icon: null},
            {id: 15, text: &#039;iPhone&#039;, checked: false, icon: null},
            {id: 16, text: &#039;Android Phone&#039;, checked: false, icon: null}];

        // Build a Default View
        $scope.member =
        {
            twitter:false,
            facebook:false,
            google:false,
            sms:true,
            email:true,
            country:2
        };

        $scope.countries_text_single = &#039;Choose country&#039;;
        $scope.platforms_text_multiple = &#039;Choose Platforms&#039;;

        // Manage the Registration Process
        $scope.user = $rootScope.user;
        $scope.page = 0;

        // Move the Name section
        $scope.next = function () {

            // Work out where we are and then the proposed action
            $scope.page = $scope.wizard.currentStepNumber();

            switch ($scope.page ) {
                case 0:
                case 1:
                    // Validate Form 1
                    $scope.actionText = &quot;Next&quot;;
                    break;
                case 2:
                    $scope.actionText = &quot;Register&quot;;
                    break;
                case 3:
                    $scope.actionText = &quot;Finish&quot;;
                    break;
            }

            // VALIDATE THE FORM
            $ionicScrollDelegate.scrollTop();
            $scope.wizard.next();
        };

        // Move the Name section
        $scope.back = function () {

            $ionicScrollDelegate.scrollTop();
            WizardHandler.wizard().previous();
        };

        // Handle Social Integration, need the FB, Twitter details to be able to
        // Post information of videos that have been added.
        $scope.authSocial = function (provider) {

            // If On THen Do it
            if($scope.member[provider]) {

                // Lets load the Videos for the Youtube Channel
                $ionicLoading.show({
                    template: &quot;&lt;i class=\&quot;ion-loading-c\&quot;&gt;&lt;/i&gt;&lt;span&gt;&amp;nbsp;Authorising with &quot;+provider.replace(/^(.){1}/,&#039;$1&#039;.toUpperCase())+&quot;...&lt;/span&gt;&quot;
                });

                // Lets Get the socual integration
                SocialIntegration.getAccessToken(provider).then(function (access) {

                    // Check we got something back
                    if(access) {
                        // Save the
                        $scope.member[provider+&quot;_token&quot;] = access;
                        if(provider===&quot;twitter&quot;) {
                            $scope.member[provider+&quot;id&quot;] = access.user.alias;
                        } else {
                            $scope.member[provider + &quot;id&quot;] = access.user.name;
                        }
                        $scope.member[provider] = true;

                    } else {
                        $scope.member[provider] = false;
                    }

                    $ionicLoading.hide();

                }, function (err) {
                    $ionicLoading.hide();
                    $scope.member.facebook = false;
                    $rootScope.wifi();
                });

            } else {
                $scope.member[provider]=false;
                delete $scope.member[provider+&quot;id&quot;];
                delete $scope.member[provider+&quot;_token&quot;];
            }

        };

        // Finish the Wizard
        $scope.register = function (member) {

            // Validate the Member information before trying to

            // Lets Validate and Add any other meta data we need
            MembersService.registerMember(member).then(function (member) {

                // Get the Global Scope
                var appscope = angular.element(&quot;body&quot;).injector().get(&quot;$rootScope&quot;);

                // Set them as Registerd
                appscope.user.registered = true;
                $scope.actionText = &quot;Finish&quot;;

                $scope.next();

            }, function (err) {
                var alertPopup = $ionicPopup.alert({
                    title: &quot;Register&quot;,
                    template: &quot;Failed to register your details, please try again later&quot;
                });
            });

        };

        // Handle the Registration Action
        $scope.action = function(member) {

            // Check what view we are on and then validate and continue
            switch($scope.page) {
                case 0:
                    $scope.next();
                    break;
                case 1:

        //            $scope.next();
        //            break;

                    // Check if Form is valid
                    if($scope.personalForm.$valid) {
                        // Display Message to Users
                        $scope.next();
                    } else {
                        var alertPopup = $ionicPopup.alert({
                            title: &#039;Register&#039;,
                            template: &#039;To complete registration, enter all your personal details, thank you&#039;
                        });

                        alertPopup.then(function (res) {
                            // Handle the Next step
                        });
                    }
                    break;

                case 2:

                    // Check we have one Social integration
                    if($scope.socialForm.$valid) {

                        debugger;

                        // Add in the Logged in User Details
                        member.muuid = $rootScope.user.raw.id;
                        member.user = $rootScope.user;

                        $scope.register(member);
                    }

                    break;
                case 3 :
                    $scope.finish();
                    break;
            }

        }

        // Finish the Wizard
        $scope.finish = function () {
            $state.go(&quot;intro&quot;);
        };

        // Handle the the cancel
        $scope.cancel = function () {
            $state.go(&quot;intro&quot;);
        };
    })



// A simple controller that shows a tapped item&quot;s data
    .controller(&quot;AccountCtrl&quot;, function ($ionicScrollDelegate, $ionicLoading, $rootScope, $state, $scope, MembersService, WizardHandler) {

        // Manage the Registration Process
        var user = $rootScope.user;

        // No User lets navigate
        if (!user) {
            $state.go(&quot;signin&quot;);
            return;
        }

        // If they are not registered then take them to registration
        if (!user.registered) {
            $state.go(&quot;register&quot;);
            return;
        }

        // Lets load the Videos for the Youtube Channel
        $ionicLoading.show({
            template: &quot;Getting your membership...&quot;
        });

        // Lets Get the Member information
        MembersService.getMember(user.raw.id).then(function (member) {

            $ionicLoading.hide();
            $rootScope.user.registered = true;
            $rootScope.member = member;
            $scope.member = member;

            if (!$scope.$$phase) {
                $scope.$apply();
            }
        }, function (err) {

            var alertPopup = $ionicPopup.alert({
                title: &quot;Loading Register&quot;,
                template: &quot;Failed to register your details, please try again later&quot;
            });


        });

        // Move the Name section
        $scope.save = function () {
            // Update Account Details

        };

        // Handle the the cancel
        $scope.cancel = function () {
            $state.go(&quot;intro&quot;);
        };
    });</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
