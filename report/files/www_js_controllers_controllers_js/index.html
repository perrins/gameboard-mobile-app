<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - www/js/controllers/controllers.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>www/js/controllers/controllers.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">69.51</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">573</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">33.74</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">3.94</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">angular.module(&quot;gameboard.controllers&quot;, [])

    // Only Show the Splash Screen on Sign Load
    .run(function ( $ionicPlatform,$ionicModal, $rootScope, $timeout) {

        // Hide Splash Screen
        // Handle Loading of the Runtime
        $ionicPlatform.ready(function () {

            // Create Wifi
            if(!$rootScope.wifi) {

                // Create our modal
                $ionicModal.fromTemplateUrl(&#039;templates/connectivity.html&#039;, function (modal) {
                    $rootScope.connectivity = modal;
                }, {
                    scope: $rootScope,
                    animation: &#039;slide-in-up&#039;,
                    focusFirstInput: true
                });

                $rootScope.wifi = function () {
                    // Reverse the Paint Bug
                    $rootScope.connectivity.show();
                };

                $rootScope.cancelWifi = function () {
                    // Reverse the Paint Bug
                    $rootScope.connectivity.hide();
                };

                // listen for the event in the relevant $scope
                $rootScope.$on(&#039;gb-error&#039;, function (event, err) {

                    if (_.isObject(err) &amp;&amp; _.has(err, &quot;info&quot;)) {

                        // Show Connectivity Error
                        if (err.info.status == &quot;error&quot;) {
                            $rootScope.wifi();
                        }

                    }

                });
            }


        });
    })

	.controller(&quot;MainCtrl&quot;, function ($rootScope,  $scope, $location, $state, $ionicSideMenuDelegate, $ionicHistory) {

        // Check if we are in local testing mode and then fake a user
        // and go to the Intro Views.
        if ($rootScope.config.localsecurity || typeof OAuth == &#039;undefined&#039;) {

            $rootScope.user = {
                &quot;id&quot;: &quot;1292030202022&quot;,
                &quot;gametag&quot;: &quot;lolperrins123&quot;,
                &quot;avatar&quot;: &quot;img/avatar.png&quot;,
                &quot;firstname&quot;: &quot;Joe&quot;,
                &quot;lastname&quot;: &quot;Perrins&quot;,
                &quot;registered&quot;: false
            };
            $rootScope.member = {
                &quot;muuid&quot;: 282992902,
                &quot;gametag&quot;: &quot;lolperrins123&quot;,
                &quot;name&quot;: &quot;Joe&quot;,
                &quot;surname&quot;: &quot;Perrins&quot;,
                &quot;memberSince&quot;: &quot;01/01/2014&quot;,
                &quot;avatar&quot;: &quot;img/avatar.png&quot;,
                &quot;bio&quot;: &quot;The best minecraft player on the planet&quot;,
                &quot;prizes&quot;: &quot;£23,456&quot;,
                &quot;views&quot;: &quot;4,343&quot;

            };

        };


        // Prepare User for Display
		if ($rootScope.user) {

			// So we have a User lets loo
			$scope.user = $rootScope.user;
			$scope.member = $rootScope.member;

			$scope.members = 2302243;
			$scope.notifications = 6;
			$scope.videos = 3;
			$scope.favourites = 5;

			// Clear the Back stack
			$ionicHistory.nextViewOptions({
				disableBack: true
			});

		} else {

			// Clear the Back stack
			$ionicHistory.nextViewOptions({
				disableBack: true,
				disableAnimate: true
			});

		}

		$scope.logout = function () {

			// Clear the Back stack
			$ionicHistory.nextViewOptions({
				disableBack: true
			});

			// Remove the User State
			$rootScope.user = null;
			$rootScope.member = null;

			// Do an OAuth Logout Here
			$state.go(&quot;signin&quot;);

		};

	})

// Sign In Controller, navigate to Intro
	.controller(&quot;SignInCtrl&quot;, function ($cordovaNetwork, $ionicHistory, $rootScope, $state, $scope, $http, MembersService, $ionicLoading, Settings,ACCESS,$q) {

        // Clear the Back stack
		$ionicHistory.nextViewOptions({
			disableBack: true,
			disableAnimate: true
		});

		// Signon to the App
		$scope.signon = function () {

			// Lets load the Videos for the Youtube Channel
			$ionicLoading.show({
                template: &quot;&lt;i class=\&quot;ion-loading-c\&quot;&gt;&lt;/i&gt;&lt;span&gt;&amp;nbsp;Authenticating...&lt;/span&gt;&quot;
			});

			var nextView = function () {

				// Clear the Back stack
				$ionicHistory.nextViewOptions({
					disableBack: true
				});

				// If we have displayed the screen before lets go to Main
				if (!Settings.get(&quot;INTRO&quot;)) {
					$state.go(&quot;board.genres&quot;);

				} else {
					$state.go(&quot;intro&quot;);
				}

			};

            function checkConnection() {
                var networkState = navigator.connection.type;

                var states = {};
                states[Connection.UNKNOWN]  = &#039;Unknown connection&#039;;
                states[Connection.ETHERNET] = &#039;Ethernet connection&#039;;
                states[Connection.WIFI]     = &#039;WiFi connection&#039;;
                states[Connection.CELL_2G]  = &#039;Cell 2G connection&#039;;
                states[Connection.CELL_3G]  = &#039;Cell 3G connection&#039;;
                states[Connection.CELL_4G]  = &#039;Cell 4G connection&#039;;
                states[Connection.CELL]     = &#039;Cell generic connection&#039;;
                states[Connection.NONE]     = &#039;No network connection&#039;;

                $rootScope.states = states;
                console.log(&quot;Connection : &quot;+states[networkState]);
            }

            //
            if(navigator.connection) {
                checkConnection();
                if(navigator.connection.type === Connection.NONE &amp;&amp; !$rootScope.config.localsecurity){
                    $ionicLoading.hide();
                    $rootScope.wifi();
                    return;
                } else {
                    console.log(&quot;We have a connection &quot;+$rootScope.states[navigator.connection.type]);
                }
            }

            // Check if we are in local testing mode and then fake a user
			// and go to the Intro Views.
			if ($rootScope.config.localsecurity || typeof OAuth == &#039;undefined&#039;) {

				$rootScope.user = {
					&quot;id&quot;: &quot;1292030202022&quot;,
					&quot;gametag&quot;: &quot;lolperrins123&quot;,
					&quot;avatar&quot;: &quot;img/avatar.png&quot;,
					&quot;firstname&quot;: &quot;Joe&quot;,
					&quot;lastname&quot;: &quot;Perrins&quot;,
					&quot;registered&quot;: true
				};
				$rootScope.member = {
					&quot;muuid&quot;: 282992902,
					&quot;gametag&quot;: &quot;lolperrins123&quot;,
					&quot;name&quot;: &quot;Joe&quot;,
					&quot;surname&quot;: &quot;Perrins&quot;,
					&quot;memberSince&quot;: &quot;01/01/2014&quot;,
					&quot;avatar&quot;: &quot;img/avatar.png&quot;,
					&quot;bio&quot;: &quot;The best minecraft player on the planet&quot;,
					&quot;prizes&quot;: &quot;£23,456&quot;,
					&quot;views&quot;: &quot;4,343&quot;

				};

				// Hide Message
				$ionicLoading.hide();

				// Havigate to the Board View
				nextView();

				return;
			}

			// Initialize Security
			// Initialize the OAuth settings
			OAuth.initialize($rootScope.config.security);

			var failFunc = function (err) {
				// TMD: isn&#039;t this covered by the second arg to &#039;then&#039; ?
				$ionicLoading.hide();
                $rootScope.wifi();
			};

            // Get A Code
            Q.fcall ( function () {

                // Request a Server Side Generated Auth Code
                var def = $q.defer();

                // Get handle to the CloudCode service
                var cc = IBMCloudCode.getService();
                var uri = new IBMUriBuilder().append(ACCESS.SOCIAL_AUTH_CODE).toString();

                // Get the Genres
                cc.get(uri, {
                    &quot;handleAs&quot;: &quot;json&quot;
                }).then(function (token) {
                    def.resolve(token);
                }).catch(function (err) {
                    def.reject(err);
                })

                return def.promise;

            }).then(function(token) {

                // Check we have a token
                if (_.has(token, &quot;token&quot;)) {
                    $rootScope.security_token = token;
                } else {
                    $ionicLoading.hide();
                    $rootScope.wifi();
                }

                // Create A Banner Add when in Cordova
                if (! _.isUndefined(AdMob) ) {

                    // Create the Banner Add Area through JS
                    AdMob.createBanner(
                        {
                            adId: $rootScope.config.admobid,
                            addSize: $rootScope.config.adtype,
                            position: AdMob.AD_POSITION.BOTTOM_CENTER,
                            autoShow: true
                        }, function () {
                            console.log(&quot;banner created&quot;);
                        }, function () {
                            console.log(&quot;failed to create AdMob&quot;);
                        });

                }

                // Handle the Cordova OAuth experience
                OAuth.popup(&quot;google&quot;, {
                    cache: true,
                    state : token.token
                }).done(function (google) {

                    // Save the context so we can
                    $rootScope.google = google;

                    // Set the Security Token on IBM Bluemix
                    IBMBluemix.setSecurityToken(google.access_token, IBMBluemix.SecurityProvider.GOOGLE);

                    // Lets get some information about the User
                    google.me().done(function (user) {

                        // Get the User
                        $rootScope.user = user;

                        // Get the signing in Member and see if they are registered
                        MembersService.getMember(user.raw.id).then(function (member) {


                            // Check if we have a registered member ?
                            if (_.isObject(member)) {
                                $ionicLoading.hide();
                                $rootScope.user.registered = true;
                                $rootScope.member = member;
                            } else {
                                // If not then they need to register to do stuff
                                $rootScope.user.registered = false;
                            }

                            // Move to the Next View
                            nextView();

                        }, function (err) {

                            // If Not then force them to
                            $ionicLoading.hide();
                            $rootScope.user.registered = false;

                            // Check we have an Avatar if not give them a simple one
                            if (!_.has($rootScope.user, &quot;avatar&quot;)) {
                                $rootScope.user.avatar = &quot;img/avatar.png&quot;;
                            }

                            // Move to the Next view
                            nextView();
                        });

                    }).fail(function (err) {
                        $ionicLoading.hide();
                        $rootScope.wifi();
                    });
                }).fail(function (err) {
                    $ionicLoading.hide();
                    $rootScope.wifi();
                });
            }).catch(function(err){
                $ionicLoading.hide();
                $rootScope.wifi();
            });
		};

	})


// A simple controller that shows a tapped item&quot;s data
	.controller(&quot;AboutCtrl&quot;, function ($rootScope, $scope, Settings) {

		$scope.name = &quot;Screaming Foulup&quot;;
		$scope.version = &quot;0.0.4&quot;;

		// Check
		$scope.intro = Settings.get(&quot;INTRO&quot;);

		$scope.introChange = function (intro) {

			// Set the Intro Load Screen
			Settings.set(&quot;INTRO&quot;, intro);

		};


	})

	.controller(&quot;IntroCtrl&quot;, function ($scope, $state, $ionicSlideBoxDelegate, $ionicHistory, Settings) {

		// Clear the Back stack
		$ionicHistory.nextViewOptions({
			disableAnimate: true,
			disableBack: true
		});

		// Called to navigate to the main app
		$scope.startApp = function () {

			// Clear the Back stack
			$ionicHistory.nextViewOptions({
				disableAnimate: true,
				disableBack: true
			});

			// Lets set that we have been through the Load Screen and Now no longer need to display it
			Settings.set(&quot;INTRO&quot;, false);

			// Havigate to the Board View
			$state.go(&quot;board.genres&quot;);
			//$state.go(&quot;board.board&quot;,{bid:1001});
		};

		// If we have displayed the screen before lets go to Main
		if (!Settings.get(&quot;INTRO&quot;)) {
			// Clear the Back stack
			$ionicHistory.nextViewOptions({
				disableBack: true
			});

			$state.go(&quot;board.genres&quot;);
			//$state.go(&quot;board.board&quot;,{bid:1001});
		}

		$scope.next = function () {
			$ionicSlideBoxDelegate.next();
		};
		$scope.previous = function () {
			$ionicSlideBoxDelegate.previous();
		};

		// Called each time the slide changes
		$scope.slideChanged = function (index) {
			$scope.slideIndex = index;
		};
	})

	// A simple controller that shows a tapped item&quot;s data
	.controller(&quot;PrizesCtrl&quot;, function ($rootScope, $scope, Settings) {

		// Manage the Prizes for Specific Boards and Show what is on offer


	})

    .directive(&#039;fancySelect&#039;,
    [
        &#039;$ionicModal&#039;,
        function($ionicModal) {
            return {
                /* Only use as &lt;fancy-select&gt; tag */
                restrict : &#039;E&#039;,

                /* Our template */
                templateUrl: &#039;templates/fancy-select.html&#039;,

                /* Attributes to set */
                scope: {
                    &#039;items&#039;        : &#039;=&#039;, /* Items list is mandatory */
                    &#039;text&#039;         : &#039;=&#039;, /* Displayed text is mandatory */
                    &#039;value&#039;        : &#039;=&#039;, /* Selected value binding is mandatory */
                    &#039;callback&#039;     : &#039;&amp;&#039;
                },

                link: function (scope, element, attrs) {

                    /* Default values */
                    scope.multiSelect   = attrs.multiSelect === &#039;true&#039; ? true : false;
                    scope.allowEmpty    = attrs.allowEmpty === &#039;false&#039; ? false : true;

                    /* Header used in ion-header-bar */
                    scope.headerText    = attrs.headerText || &#039;&#039;;

                    /* Text displayed on label */
                    // scope.text          = attrs.text || &#039;&#039;;
                    scope.defaultText   = scope.text || &#039;&#039;;

                    /* Notes in the right side of the label */
                    scope.noteText      = attrs.noteText || &#039;&#039;;
                    scope.noteImg       = attrs.noteImg || &#039;&#039;;
                    scope.noteImgClass  = attrs.noteImgClass || &#039;&#039;;

                    /* Optionnal callback function */
                    // scope.callback = attrs.callback || null;

                    /* Instanciate ionic modal view and set params */

                    /* Some additionnal notes here :
                     *
                     * In previous version of the directive,
                     * we were using attrs.parentSelector
                     * to open the modal box within a selector.
                     *
                     * This is handy in particular when opening
                     * the &quot;fancy select&quot; from the right pane of
                     * a side view.
                     *
                     * But the problem is that I had to edit ionic.bundle.js
                     * and the modal component each time ionic team
                     * make an update of the FW.
                     *
                     * Also, seems that animations do not work
                     * anymore.
                     *
                     */
                    $ionicModal.fromTemplateUrl(
                        &#039;templates/fancy-select-items.html&#039;,
                        {&#039;scope&#039;: scope}
                    ).then(function(modal) {
                            scope.modal = modal;
                        });

                    /* Validate selection from header bar */
                    scope.validate = function (event) {
                        // Construct selected values and selected text
                        if (scope.multiSelect == true) {

                            // Clear values
                            scope.value = &#039;&#039;;
                            scope.text = &#039;&#039;;

                            // Loop on items
                            jQuery.each(scope.items, function (index, item) {
                                if (item.checked) {
                                    scope.value = scope.value + item.id+&#039;;&#039;;
                                    scope.text = scope.text + item.text+&#039;, &#039;;
                                }
                            });

                            // Remove trailing comma
                            scope.value = scope.value.substr(0,scope.value.length - 1);
                            scope.text = scope.text.substr(0,scope.text.length - 2);
                        }

                        // Select first value if not nullable
                        if (typeof scope.value == &#039;undefined&#039; || scope.value == &#039;&#039; || scope.value == null ) {
                            if (scope.allowEmpty == false) {
                                scope.value = scope.items[0].id;
                                scope.text = scope.items[0].text;

                                // Check for multi select
                                scope.items[0].checked = true;
                            } else {
                                scope.text = scope.defaultText;
                            }
                        }

                        // Hide modal
                        scope.hideItems();

                        // Execute callback function
                        if (typeof scope.callback == &#039;function&#039;) {
                            scope.callback (scope.value);
                        }
                    }

                    /* Show list */
                    scope.showItems = function (event) {
                        event.preventDefault();
                        scope.modal.show();
                    }

                    /* Hide list */
                    scope.hideItems = function () {
                        scope.modal.hide();
                    }

                    /* Destroy modal */
                    scope.$on(&#039;$destroy&#039;, function() {
                        scope.modal.remove();
                    });

                    /* Validate single with data */
                    scope.validateSingle = function (item) {

                        // Set selected text
                        scope.text = item.text;

                        // Set selected value
                        scope.value = item.id;

                        // Hide items
                        scope.hideItems();

                        // Execute callback function
                        if (typeof scope.callback == &#039;function&#039;) {
                            scope.callback (scope.value);
                        }
                    }
                }
            };
        }
    ]
);</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
